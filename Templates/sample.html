{% extends "main_base.html" %}
{% load widget_tweaks %}

{% block title %}Travello - Passenger Form{% endblock %}

{% block content %}
<div class="container mt-4 mb-5">
    <div class="form-container p-4 bg-white rounded shadow-sm">
        <h2>Passenger Details</h2>

        <!-- Messages -->
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">{{ message }}</div>
            {% endfor %}
        {% endif %}

        <form method="POST" action="{% url 'pessanger_detail_def' city_name=city_name %}">
            {% csrf_token %}
            {{ formset.management_form }}

            <div id="formset-area">
                {% for form in formset %}
                <div class="form-row align-items-end mb-3">
                    <div class="col-md-4">
                        <label for="{{ form.first_name.id_for_label }}">First Name</label>
                        {{ form.first_name|add_class:"form-control" }}
                    </div>
                    <div class="col-md-4">
                        <label for="{{ form.last_name.id_for_label }}">Last Name</label>
                        {{ form.last_name|add_class:"form-control" }}
                    </div>
                    <div class="col-md-2">
                        <label for="{{ form.age.id_for_label }}">Age</label>
                        {{ form.age|add_class:"form-control" }}
                    </div>
                </div>
                {% endfor %}
            </div>

            <div class="form-group mt-4">
                <label for="trip_date">Trip Date</label>
                <input type="date" class="form-control w-25" name="trip_date" id="trip_date" required min="">
            </div>

            <div class="mt-4">
                <button type="submit" class="btn btn-success btn-lg">Submit</button>
                <button type="button" class="btn btn-outline-primary ml-2" id="add-pessanger">Add New Passenger</button>
            </div>
        </form>
    </div>
</div>
{% endblock content %}

{% block scripts %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    // Set today's date as min for date input
    document.addEventListener('DOMContentLoaded', function () {
        const dateInput = document.getElementById('trip_date');
        const today = new Date().toISOString().split('T')[0];
        dateInput.setAttribute('min', today);
    });

    // Add passenger dynamically
    $(function() {
        let form_num = parseInt($('#id_form-TOTAL_FORMS').val()) || 0;

        $('#add-pessanger').click(function (e) {
            e.preventDefault();

            const newFormNum = form_num;

            const newForm = `
            <div class="form-row align-items-end mb-3">
                <div class="col-md-4">
                    <label for="id_form-${newFormNum}-first_name">First Name</label>
                    <input type="text" name="form-${newFormNum}-first_name" class="form-control" required id="id_form-${newFormNum}-first_name">
                </div>
                <div class="col-md-4">
                    <label for="id_form-${newFormNum}-last_name">Last Name</label>
                    <input type="text" name="form-${newFormNum}-last_name" class="form-control" required id="id_form-${newFormNum}-last_name">
                </div>
                <div class="col-md-2">
                    <label for="id_form-${newFormNum}-age">Age</label>
                    <input type="number" name="form-${newFormNum}-age" class="form-control" min="1" max="100" required id="id_form-${newFormNum}-age">
                </div>
            </div>`;

            $('#formset-area').append(newForm);

            form_num++;
            $('#id_form-TOTAL_FORMS').val(form_num);
        });
    });
</script>
{% endblock scripts %}
